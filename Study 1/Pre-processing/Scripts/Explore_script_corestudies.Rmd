---
title: "Explore_script_corestudies"
output: html_document
date: "2024-01-23"
---

## Load packages and data

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(haven)
library(psych)
```


```{r}
# Integration and Leisure
liss4 <- read_sav(".../DTD-donation/Study 1/Data/cs22o_EN_1.1p.sav")
# Personality
liss7 <- read_sav(".../DTD-donation/Study 1/Data/cp23o_EN_1.0p.sav")
# Politics and Values
liss8 <- read_sav(".../DTD-donation/Study 1/Data/cv23o_EN_1.0p.sav")
# Background
lissback <- read_sav(".../DTD-donation/Study 1/Data/avars_202309_EN_1.0p.sav")
```

## Data Wrangling

### Data Selection & Cleaning

-   Drop non-relevant variables, decrease dataframe width. 
-   Check for and handle outliers, if any.
-   Prepare joint dataframe for further analysis.

```{r}
# liss 4

# get index of variables

which(names(liss4) == "cs22o028")
which(names(liss4) == "cs22o037")
which(names(liss4) == "cs22o534")
which(names(liss4) == "cs22o063")

# select variables of interest
liss4 <- liss4 %>% 
  select(1, 3, 29:43, 82:83)

```

```{r}
# merge binary variables into categories, as described in analytical strategy

org_hum <- apply(liss4[,3:7], 1, function(row) {
  if (all(is.na(row))) {
    return("None")
  } else {
    one_indices <- which(row == 1)
    if (length(one_indices) == 0) {
      return("None")
    } else if (length(one_indices) == 1) {
      return(names(row)[one_indices])
    } else {
      return("Mixed")
    }
  }
})

org_hum <- recode(org_hum, cs22o028 = "no connection", 
                           cs22o029 = "donated money", 
                           cs22o030 = "participated in an activity",
                           cs22o031 = "member",
                           cs22o032 = "performed voluntary work")
liss4$org_hum <- org_hum

org_mig <- apply(liss4[,8:12], 1, function(row) {
  if (all(is.na(row))) {
    return("None")
  } else {
    one_indices <- which(row == 1)
    if (length(one_indices) == 0) {
      return("None")
    } else if (length(one_indices) == 1) {
      return(names(row)[one_indices])
    } else {
      return("Mixed")
    }
  }
})

org_mig <- recode(org_mig, cs22o523 = "no connection", 
                           cs22o524 = "donated money", 
                           cs22o525 = "participated in an activity",
                           cs22o526 = "member",
                           cs22o527 = "performed voluntary work")
liss4$org_mig <- org_mig

org_env <- apply(liss4[,13:17], 1, function(row) {
  if (all(is.na(row))) {
    return("None")
  } else {
    one_indices <- which(row == 1)
    if (length(one_indices) == 0) {
      return("None")
    } else if (length(one_indices) == 1) {
      return(names(row)[one_indices])
    } else {
      return("Mixed")
    }
  }
})

org_env <- recode(org_env,  cs22o033 = "no connection", 
                            cs22o034 = "donated money", 
                            cs22o035 = "participated in an activity",
                            cs22o036 = "member",
                            cs22o037 = "performed voluntary work")

liss4$org_env <- org_env

liss4[,20:22]
```


```{r}
# liss 7

# variables are ordered as follows: 
# 1 - extroversion
# 2 - Agreeableness
# 3 - Neuroticism
# 4 - Conscientiousness
# 5 - Openness to new experience

# get index of variables

which(names(liss7) == "cp23o019")

# select variables of interest
liss7 <- liss7 %>% 
  select(1, 3:4, 12:63)

```

```{r}
# liss 8

# get index of variables

which(names(liss8) == "cv23o09")
which(names(liss8) == "cv23o012")
which(names(liss8) == "cv23o053")
which(names(liss8) == "cv23o065")
which(names(liss8) == "cv23o073")

# select variables of interest
liss8 <- liss8 %>% 
  select(1, 17:20, 61, 90:98)
```


### Data Format Inspection

-   Inspect the data to understand its structure, variable names, and data types.

```{r}
str(liss4)
str(liss7)
str(liss8)
```

## Exploratory Analysis

#### Liss 4 

checking if variables are applicable

```{r}
# Function to create a histogram for a given variable

datagraph <- liss4[,3:17] %>% gather()
datagraph$value <- factor(datagraph$value)
str(datagraph)
ggplot(datagraph, aes(x = value)) + 
    geom_bar() + 
    facet_wrap(~key, scales = "fixed") + 
    theme_minimal()
```

```{r}
datagraph <- liss4[,20:22] %>% gather()
datagraph$value <- factor(datagraph$value)
ggplot(datagraph, aes(x = value)) + 
    geom_bar() + 
    facet_wrap(~key, scales = "fixed") + 
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

#### Liss 7 

Checking if variables are applicable. Big-5 calculation.

```{r}
BIG5 <- liss7[,5:54]
liss7 <- liss7[,1:55]

extrov <- 20 + BIG5[,1] - BIG5[,6] + BIG5[,11] - BIG5[,16] + BIG5[,21] - BIG5[,26] + BIG5[,31] - BIG5[,36] + BIG5[,41] - BIG5[,46]
agreab <- 14 - BIG5[,2] + BIG5[,7] - BIG5[,12] + BIG5[,17] - BIG5[,22] + BIG5[,27] - BIG5[,32] + BIG5[,37] + BIG5[,42] + BIG5[,47]
conscient <- 14 + BIG5[,3] - BIG5[,8] + BIG5[,13] - BIG5[,18] + BIG5[,23] - BIG5[,28] + BIG5[,33] - BIG5[,38] + BIG5[,43] + BIG5[,48]
neurot <- 38 - BIG5[,4] + BIG5[,9] - BIG5[,14] + BIG5[,19] - BIG5[,24] - BIG5[,29] - BIG5[,34] - BIG5[,39] - BIG5[,44] - BIG5[,49]
openess <- 8 + BIG5[,5] - BIG5[,10] + BIG5[,15] - BIG5[,20] + BIG5[,25] - BIG5[,30] + BIG5[,35] + BIG5[,40] + BIG5[,45] + BIG5[,50]

table(agreab)
table(extrov)
table(conscient)
table(neurot)
table(openess)

liss7$agreab <- as.vector(agreab$cp23o021)
liss7$extrov <- as.vector(extrov$cp23o020)
liss7$conscient <- as.vector(conscient$cp23o022)
liss7$neurot <- as.vector(neurot$cp23o023)
liss7$openess <- as.vector(openess$cp23o024)
```

```{r}
datagraph <- liss7[,56:60] %>% gather()
ggplot(datagraph, aes(x = value)) + 
    geom_density(alpha = 0.5) + 
    facet_wrap(~key, scales = "fixed") + 
    theme_minimal()
```

```{r}
ggplot(liss7, aes(x = cp23o019)) + 
    geom_bar() + 
    theme_minimal() +
  labs(
    title = "Generalized Trust Question",
    x = "(1 - can't be too careful; 10 - Most people can be trusted)",
    y = "Frequency"
  )
```

#### Liss 8

checking if variables are applicable

```{r}
datagraph <- liss8[,2:6] %>% gather()
datagraph$value <- factor(datagraph$value)
ggplot(datagraph, aes(x = value)) + 
    geom_bar() + 
    facet_wrap(~key, scales = "fixed") + 
    theme_minimal()
```

## Data Merging

Merge dataframes into one dataframe for further analysis.

```{r}
merged_df <- merge(liss4, liss7, by = "nomem_encr", all = TRUE)
merged_df <- merge(merged_df, liss8, by = "nomem_encr", all = TRUE)
result_df <- lissback %>%
  right_join(merged_df, by = "nomem_encr")

result_df$org_hum[result_df$org_hum == "None"] <- NA
result_df$org_env[result_df$org_env == "None"] <- NA
result_df$org_mig[result_df$org_mig == "None"] <- NA
```

Visualize to ensure correct calculation

```{r}
ggplot(result_df, aes(x = cp23o019, fill = org_hum)) + 
    geom_bar() + 
    theme_minimal() +
  labs(
    title = "Generalized Trust by Altruism",
    x = "Generalized Trust (1 - can't be too careful; 10 - Most people can be trusted)",
    y = "Frequency"
  )
```

Transform variable for altruism in a resulting dataframe

```{r}
result_df$org_env_binary <- ifelse(result_df$org_env == "no connection", "No", "Yes")
result_df$org_hum_binary <- ifelse(result_df$org_hum == "no connection", "No", "Yes")
result_df$org_mig_binary <- ifelse(result_df$org_mig == "no connection", "No", "Yes")
```

And visualise it

```{r}
ggplot(result_df, aes(x = cp23o019, fill = org_env_binary)) + 
    geom_bar() + 
    theme_minimal() +
  labs(
    title = "Generalized Trust by Altruism",
    x = "Generalized Trust (1 - can't be too careful; 10 - Most people can be trusted)",
    y = "Frequency"
  )
```

## Export Data

```{r}
write.csv(result_df, ".../DTD-donation/Study 1/Data/df_liss.csv")
```


