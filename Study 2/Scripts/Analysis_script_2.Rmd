---
title: "Analysis_script_2"
output: html_document
date: "2024-05-11"
---

## Load Packages and data

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

load all variables

```{r}
library(xtable)
library(mice)
library(tidyverse)
library(haven)
library(psych)
library(survey)
library(caret)
library(boot)
library(Metrics)
library(e1071)
```

```{r}
df_raw <- read.csv("C:/Users/danch/OneDrive/2 Course MS/Thesis/Data/df_an1.csv", header=TRUE)[,2:268]
```

## Preprocessing

Select utilized variables

```{r}
df <- df_raw[,c("status", "QA7", "QA5", "QA10a", "QA10f_text", "alt_chat_use", "altruism", "civic_duty", "QA8b", "QA8a", "cp23o019", "openess", "extrov", "neurot", "conscient", "agreab", "geslacht", "gebjaar_nm", "sted", "nettocat", "oplcat_bin", "oplcat", "belbezig", "QA11",  "AccountPackageID")]

## Load & Join number of contacts
df_parsed <- read.csv("C:/Users/danch/OneDrive/2 Course MS/Thesis/Data/parsed_contacts.csv")
```

Exclusion of screened out is implemented as they are not the part of the survey population.

```{r}
df <- df[!df$status == "screened_out",]
```

### Recoding

Add Employment variable

```{r}
df$belbezig <- ifelse(df$belbezig %in% c(1, 2, 3), 1, 0)
```

Split alt_chat_use into other_messenger and secure_messenger.

```{r}
df$secure_messenger <- df$alt_chat_use
df$alt_chat_use <- NULL
df$other_messenger <- ifelse(nchar(as.character(df$QA10f_text)) > 0, 1, 0)
df$QA10f_text <- NULL

# Move 22nd and 23rd columns to be the 4th and 5th columns
df <- df[, c(1:4, 24:25, 5:23)]
head(df)
```

If NA for Q11, then recode as 0

```{r}
df$QA11 <- ifelse(is.na(df$QA11), 0, df$QA11)
```

Join number of contacts from df_parsed$contacen to df

```{r}
dfcontact <- merge(df, df_parsed, by="AccountPackageID")
# drop if error in exctraction == "Yes"
dfcontact <- dfcontact[dfcontact$Error_in_extraction == "No",]
# detach columns 26-28, 30
dfcontact <- dfcontact[,c(2:25, 29)]
```

### Missing Data

Implement data imputation to counter ITEM non-response, where MAR can be assumed.  

```{r}
#df_clean <- df[rowSums(is.na(df)) <= 3, ]
df_imp <- mice(df, m=5, maxit=25, method="pmm", seed=500)
df <- complete(df_imp)

dfcontact_imp <- mice(dfcontact, m=5, maxit=25, method="pmm", seed=500)
dfcontact <- complete(dfcontact_imp)
```

Drop "donator" and "oplcat" Ñols

```{r}
dfcontact <- dfcontact[,2:25]
dfcontact <- dfcontact[,-c(21)]
df <- df[,1:24]
```

## Data Simulation

### Define simulation function

```{r}
calculate_X <- function(dftr, num, n) {
  set.seed(123)
  
  # Calculate probability table from QA7 column
  prob_table <- as.vector(round(table(dftr[[num]]) / sum(table(dftr[[num]])), 2))
  
  # Generate X values based on probability table
  x <- sample(
    min(as.numeric(names(table(dftr[[num]])))):max(as.numeric(names(table(dftr[[num]])))),
    n,
    replace = TRUE,
    prob = prob_table
  )
  
  return(x)
}
```

### Simulate Head Data

```{r}
set.seed(123)
n = 4000
frac = 0.1

# for categorical < 20 categories
privacy_concerns <- calculate_X(df, 2, n)
smartphone_skill <- calculate_X(df, 3, n)
whatsapp_usage <- calculate_X(df, 4, n)
secure_messenger <- calculate_X(df, 5, n)
other_messenger <- calculate_X(df, 6, n)
altruism <- calculate_X(df, 7, n)
civic_duty <- calculate_X(df, 8, n)
trust_science <- calculate_X(df, 9, n)
trust_polsters <- calculate_X(df, 10, n)
trust_gen <- calculate_X(df, 11, n)
## For categorical controls
sted <- calculate_X(df, 20, n)
inc_cat <- calculate_X(df, 21, n)
educ_cat <- calculate_X(df, 22, n)
employ_bin <- calculate_X(df, 23, n)

## For continuous 
extrov <- sample(names(table(df$extrov)), n, replace=TRUE, prob=as.vector(round(table(df$extrov) / sum(table(df$extrov)), 2)))
openess <- sample(names(table(df$openess)), n, replace=TRUE, prob=as.vector(round(table(df$openess) / sum(table(df$openess)), 2)))
neurot <- sample(names(table(df$neurot)), n, replace=TRUE, prob=as.vector(round(table(df$neurot) / sum(table(df$neurot)), 2)))
consient <- sample(names(table(df$conscient)), n, replace=TRUE, prob=as.vector(round(table(df$conscient) / sum(table(df$conscient)), 2)))
agreab <- sample(names(table(df$agreab)), n, replace=TRUE, prob=as.vector(round(table(df$agreab) / sum(table(df$agreab)), 2)))
age_n <- sample(names(table(df$gebjaar_nm)), n, replace=TRUE, prob=as.vector(round(table(df$gebjaar_nm) / sum(table(df$gebjaar_nm)), 2)))

## Join Data
dftr_sim <- data.frame(
  privacy_concerns,
  smartphone_skill,
  whatsapp_usage,
  secure_messenger,
  other_messenger,
  altruism,
  civic_duty,
  trust_science,
  trust_polsters,
  trust_gen,
  extrov,
  openess,
  neurot,
  consient,
  agreab,
  age_n,
  sted,
  inc_cat,
  educ_cat,
  employ_bin
)
dftr_sim <- apply(dftr_sim, 2, as.numeric)
dftr_sim <- as.data.frame(dftr_sim)
```

### Determine Dependency Structure

#### Linear option

```{r}
dftr_sim_l <- dftr_sim 
dftr_sim_l$Y_contacts <-  with(dftr_sim, 75 + 
                           10 * privacy_concerns + 
                           10 * smartphone_skill + 
                           10 * whatsapp_usage + 
                           -10 * secure_messenger + 
                           -10 * other_messenger + 
                           10 * altruism +
                           10 * civic_duty +
                           10 * trust_science + 
                           10 * trust_polsters + 
                           10 * trust_gen + 
                           1 * extrov +
                           1 * openess + 
                           1 * neurot +
                           1 * consient +
                           1 * agreab +
                           1 * age_n + 
                           5 * sted +
                           5 * inc_cat + 
                           3 * educ_cat + 
                           5 * employ_bin +
                           rbinom(nrow(dftr_sim), 100, 0.5)
                         )
```

#### Non-Linear option

```{r}
dftr_sim_nl <- dftr_sim 
dftr_sim_nl$Y_contacts <-  with(dftr_sim, 75 + 
                           10 * privacy_concerns + 
                           10 * smartphone_skill + 
                           10 * whatsapp_usage + 
                           -10 * secure_messenger + 
                           -10 * other_messenger + 
                           10 * altruism +
                           10 * civic_duty +
                           10 * trust_science + 
                           10 * trust_polsters + 
                           10 * trust_gen + 
                           1 * extrov +
                           1 * openess + 
                           1 * neurot +
                           1 * consient +
                           1 * agreab +
                           1 * age_n + 
                           5 * sted +
                           5 * inc_cat + 
                           3 * educ_cat + 
                           5 * employ_bin +
                           10 * (privacy_concerns)^2 + 
                           10 * (smartphone_skill)^2 + 
                           10 * (whatsapp_usage)^3 + 
                           -10 *(secure_messenger)^3 +   
                           rbinom(nrow(dftr_sim), 100, 0.5)
                         )
```

### Save Raw Simulated Data

```{r}
setwd(".../DTD-donation/Study 2/Data")
write.csv(dftr_sim_l, "dftr_sim_l.csv", row.names = FALSE)
write.csv(dftr_sim_nl, "dftr_sim_nl.csv", row.names = FALSE)
```

### Specify Donators sets (train sets)

Below, a separate dataset is specified and saved for each condition (scenario) tested in our research. 

#### Linear option

```{r}
set.seed(123)
# sample 100, 200, 400, or 600 observations 
donators1 <- sample(1:nrow(dftr_sim_l), 100)
donators2 <- sample(1:nrow(dftr_sim_l), 200)
donators3 <- sample(1:nrow(dftr_sim_l), 400)
donators4 <- sample(1:nrow(dftr_sim_l), 600)
# Select subsets
dftr_sim_l1 <- dftr_sim_l[donators1,]
dftr_sim_l2 <- dftr_sim_l[donators2,]
dftr_sim_l3 <- dftr_sim_l[donators3,]
dftr_sim_l4 <- dftr_sim_l[donators4,]
```

#### Non-Linear option

```{r}
set.seed(123)
# sample 100, 200, 400, or 600 observations 
donators1_nl <- sample(1:nrow(dftr_sim_nl), 100)
donators2_nl <- sample(1:nrow(dftr_sim_nl), 200)
donators3_nl <- sample(1:nrow(dftr_sim_nl), 400)
donators4_nl <- sample(1:nrow(dftr_sim_nl), 600)
# Select subsets
dftr_sim_nl1 <- dftr_sim_nl[donators1_nl,]
dftr_sim_nl2 <- dftr_sim_nl[donators2_nl,]
dftr_sim_nl3 <- dftr_sim_nl[donators3_nl,]
dftr_sim_nl4 <- dftr_sim_nl[donators4_nl,]
```

### Specify Share of available information

#### Linear option

For each subset, 2 subsets are created - 30% or 60%.

```{r}
# 30% of information
dftr_sim_l1_30 <- dftr_sim_l1[,c(15:21)]
dftr_sim_l2_30 <- dftr_sim_l2[,c(15:21)]
dftr_sim_l3_30 <- dftr_sim_l3[,c(15:21)]
dftr_sim_l4_30 <- dftr_sim_l4[,c(15:21)]

# 60% of information
dftr_sim_l1_60 <- dftr_sim_l1[,c(1:6,15:21)]
dftr_sim_l2_60 <- dftr_sim_l2[,c(1:6,15:21)]
dftr_sim_l3_60 <- dftr_sim_l3[,c(1:6,15:21)]
dftr_sim_l4_60 <- dftr_sim_l4[,c(1:6,15:21)]
```

#### Non-Linear option

```{r}
# 30% of information
dftr_sim_nl1_30 <- dftr_sim_nl1[,c(15:21)]
dftr_sim_nl2_30 <- dftr_sim_nl2[,c(15:21)]
dftr_sim_nl3_30 <- dftr_sim_nl3[,c(15:21)]
dftr_sim_nl4_30 <- dftr_sim_nl4[,c(15:21)]

# 60% of information
dftr_sim_nl1_60 <- dftr_sim_nl1[,c(1:6,15:21)]
dftr_sim_nl2_60 <- dftr_sim_nl2[,c(1:6,15:21)]
dftr_sim_nl3_60 <- dftr_sim_nl3[,c(1:6,15:21)]
dftr_sim_nl4_60 <- dftr_sim_nl4[,c(1:6,15:21)]
```

## Running Empirical Analysis

We do not tune the models by default, using base specification for train parameters.

```{r}
cvcontrol <- trainControl(method = "repeatedcv", 
                          number = 10,
                          allowParallel = TRUE)
```

Now, to running the models.

```{r}
set.seed(123)
lmf <- lm(contacten ~ ., data=dfcontact) 
bag_train <- train(contacten ~ .,
                   data = dfcontact , 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train <- train(contacten ~ .,
                  data = dfcontact , 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train <- train(contacten ~ .,
                   data = dfcontact ,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm = svm(contacten ~ ., data = dfcontact , kernel = "linear", cost = 10, scale = FALSE)
svmr = svm(contacten ~ ., data = dfcontact , kernel = "radial", cost = 10, scale = FALSE)
```

## Running Simulations

Below, each scenario is explored, given the models and the train sets. The code below should be run to store the results of individual scenarios, which we use to extract predicted values.

#### Linear options

##### 30% of information

###### Donators 100

```{r}
lmf1_1 <- lm(Y_contacts ~ ., data=dftr_sim_l1_30) 
bag_train1_1 <- train(Y_contacts ~ .,
                   data = dftr_sim_l1_30, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train1_1 <- train(Y_contacts ~ .,
                  data = dftr_sim_l1_30, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train1_1 <- train(Y_contacts ~ .,
                   data = dftr_sim_l1_30,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm1_1 = svm(Y_contacts ~ ., data = dftr_sim_l1_30, kernel = "linear", cost = 1, scale = FALSE)
svmr1_1 = svm(Y_contacts ~ ., data = dftr_sim_l1_30, kernel = "radial", cost = 1, scale = FALSE)
```

###### Donators 200

```{r}
lmf2_1 <- lm(Y_contacts ~ ., data=dftr_sim_l2_30)
bag_train2_1 <- train(Y_contacts ~ .,
                   data = dftr_sim_l2_30, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train2_1 <- train(Y_contacts ~ .,
                  data = dftr_sim_l2_30, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train2_1 <- train(Y_contacts ~ .,
                   data = dftr_sim_l2_30,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm2_1 = svm(Y_contacts ~ ., data = dftr_sim_l2_30, kernel = "linear", cost = 1, scale = FALSE)
svmr2_1 = svm(Y_contacts ~ ., data = dftr_sim_l2_30, kernel = "radial", cost = 1, scale = FALSE)
```

###### Donators 400

```{r}
lmf3_1 <- lm(Y_contacts ~ ., data=dftr_sim_l3_30)
bag_train3_1 <- train(Y_contacts ~ .,
                   data = dftr_sim_l3_30, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train3_1 <- train(Y_contacts ~ .,
                  data = dftr_sim_l3_30, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train3_1 <- train(Y_contacts ~ .,
                   data = dftr_sim_l3_30,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm3_1 = svm(Y_contacts ~ ., data = dftr_sim_l3_30, kernel = "linear", cost = 1, scale = FALSE)
svmr3_1 = svm(Y_contacts ~ ., data = dftr_sim_l3_30, kernel = "radial", cost = 1, scale = FALSE)
```

###### Donators 600

```{r}
lmf4_1 <- lm(Y_contacts ~ ., data=dftr_sim_l4_30)
bag_train4_1 <- train(Y_contacts ~ .,
                   data = dftr_sim_l4_30, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train4_1 <- train(Y_contacts ~ .,
                   data = dftr_sim_l4_30, 
                   method = 'rf',
                   trControl = cvcontrol,
                   importance = TRUE)
gbm_train4_1 <- train(Y_contacts ~ .,
                   data = dftr_sim_l4_30,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm4_1 = svm(Y_contacts ~ ., data = dftr_sim_l4_30, kernel = "linear", cost = 1, scale = FALSE)
svmr4_1 = svm(Y_contacts ~ ., data = dftr_sim_l4_30, kernel = "radial", cost = 1, scale = FALSE)
```


##### 60% of information

###### Donators 100

```{r}
lmf1_2 <- lm(Y_contacts ~ ., data=dftr_sim_l1_60)
bag_train1_2 <- train(Y_contacts ~ .,
                   data = dftr_sim_l1_60, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train1_2 <- train(Y_contacts ~ .,
                  data = dftr_sim_l1_60, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train1_2 <- train(Y_contacts ~ .,
                   data = dftr_sim_l1_60,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm1_2 = svm(Y_contacts ~ ., data = dftr_sim_l1_60, kernel = "linear", cost = 1, scale = FALSE)
svmr1_2 = svm(Y_contacts ~ ., data = dftr_sim_l1_60, kernel = "radial", cost = 1, scale = FALSE)
```


###### Donators 200

```{r}
lmf2_2 <- lm(Y_contacts ~ ., data=dftr_sim_l2_60)
bag_train2_2 <- train(Y_contacts ~ .,
                   data = dftr_sim_l2_60, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train2_2 <- train(Y_contacts ~ .,
                  data = dftr_sim_l2_60, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train2_2 <- train(Y_contacts ~ .,
                   data = dftr_sim_l2_60,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm2_2 = svm(Y_contacts ~ ., data = dftr_sim_l2_60, kernel = "linear", cost = 1, scale = FALSE)
svmr2_2 = svm(Y_contacts ~ ., data = dftr_sim_l2_60, kernel = "radial", cost = 1, scale = FALSE)
```

###### Donators 400

```{r}
lmf3_2 <- lm(Y_contacts ~ ., data=dftr_sim_l3_60)
bag_train3_2 <- train(Y_contacts ~ .,
                   data = dftr_sim_l3_60, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train3_2 <- train(Y_contacts ~ .,
                  data = dftr_sim_l3_60, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train3_2 <- train(Y_contacts ~ .,
                   data = dftr_sim_l3_60,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm3_2 = svm(Y_contacts ~ ., data = dftr_sim_l3_60, kernel = "linear", cost = 1, scale = FALSE)
svmr3_2 = svm(Y_contacts ~ ., data = dftr_sim_l3_60, kernel = "radial", cost = 1, scale = FALSE)
```


###### Donators 600

```{r}
lmf4_2 <- lm(Y_contacts ~ ., data=dftr_sim_l4_60)
bag_train4_2 <- train(Y_contacts ~ .,
                   data = dftr_sim_l4_60, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train4_2 <- train(Y_contacts ~ .,
                  data = dftr_sim_l4_60, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train4_2 <- train(Y_contacts ~ .,
                   data = dftr_sim_l4_60,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm4_2 = svm(Y_contacts ~ ., data = dftr_sim_l4_60, kernel = "linear", cost = 1, scale = FALSE)
svmr4_2 = svm(Y_contacts ~ ., data = dftr_sim_l4_60, kernel = "radial", cost = 1, scale = FALSE)
```


#### Non-Linear option

##### 30% of information

###### Donators 100

```{r}
lmf1_1_nl <- lm(Y_contacts ~ ., data=dftr_sim_nl1_30)
bag_train1_1_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl1_30, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train1_1_nl <- train(Y_contacts ~ .,
                  data = dftr_sim_nl1_30, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train1_1_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl1_30,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm1_1_nl = svm(Y_contacts ~ ., data = dftr_sim_nl1_30, kernel = "linear", cost = 1, scale = FALSE)
svmr1_1_nl = svm(Y_contacts ~ ., data = dftr_sim_nl1_30, kernel = "radial", cost = 1, scale = FALSE)
```

###### Donators 200

```{r}
lmf2_1_nl <- lm(Y_contacts ~ ., data=dftr_sim_nl2_30)
bag_train2_1_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl2_30, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train2_1_nl <- train(Y_contacts ~ .,
                  data = dftr_sim_nl2_30, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train2_1_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl2_30,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm2_1_nl = svm(Y_contacts ~ ., data = dftr_sim_nl2_30, kernel = "linear", cost = 1, scale = FALSE)
svmr2_1_nl = svm(Y_contacts ~ ., data = dftr_sim_nl2_30, kernel = "radial", cost = 1, scale = FALSE)
```

###### Donators 400

```{r}
lmf3_1_nl <- lm(Y_contacts ~ ., data=dftr_sim_nl3_30)
bag_train3_1_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl3_30, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train3_1_nl <- train(Y_contacts ~ .,
                  data = dftr_sim_nl3_30, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train3_1_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl3_30,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm3_1_nl = svm(Y_contacts ~ ., data = dftr_sim_nl3_30, kernel = "linear", cost = 1, scale = FALSE)
svmr3_1_nl = svm(Y_contacts ~ ., data = dftr_sim_nl3_30, kernel = "radial", cost = 1, scale = FALSE)
```

###### Donators 600

```{r}
lmf4_1_nl <- lm(Y_contacts ~ ., data=dftr_sim_nl4_30)
bag_train4_1_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl4_30, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train4_1_nl <- train(Y_contacts ~ .,
                  data = dftr_sim_nl4_30, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train4_1_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl4_30,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm4_1_nl = svm(Y_contacts ~ ., data = dftr_sim_nl4_30, kernel = "linear", cost = 1, scale = FALSE)
svmr4_1_nl = svm(Y_contacts ~ ., data = dftr_sim_nl4_30, kernel = "radial", cost = 1, scale = FALSE)
```

##### 60% of information

###### Donators 100

```{r}
lmf1_2_nl <- lm(Y_contacts ~ ., 
                   data=dftr_sim_nl1_60)
bag_train1_2_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl1_60, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train1_2_nl <- train(Y_contacts ~ .,
                  data = dftr_sim_nl1_60, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train1_2_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl1_60,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm1_2_nl = svm(Y_contacts ~ ., data = dftr_sim_nl1_60, kernel = "linear", cost = 1, scale = FALSE)
svmr1_2_nl = svm(Y_contacts ~ ., data = dftr_sim_nl1_60, kernel = "radial", cost = 1, scale = FALSE)
```

###### Donators 200

```{r}
lmf2_2_nl <- lm(Y_contacts ~ ., data=dftr_sim_nl2_60)
bag_train2_2_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl2_60, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train2_2_nl <- train(Y_contacts ~ .,
                  data = dftr_sim_nl2_60, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train2_2_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl2_60,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm2_2_nl = svm(Y_contacts ~ ., data = dftr_sim_nl2_60, kernel = "linear", cost = 1, scale = FALSE)
svmr2_2_nl = svm(Y_contacts ~ ., data = dftr_sim_nl2_60, kernel = "radial", cost = 1, scale = FALSE)
```

###### Donators 400

```{r}
lmf3_2_nl <- lm(Y_contacts ~ ., data=dftr_sim_nl3_60)
bag_train3_2_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl3_60, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train3_2_nl <- train(Y_contacts ~ .,
                  data = dftr_sim_nl3_60, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train3_2_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl3_60,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm3_2_nl = svm(Y_contacts ~ ., data = dftr_sim_nl3_60, kernel = "linear", cost = 1, scale = FALSE)
svmr3_2_nl = svm(Y_contacts ~ ., data = dftr_sim_nl3_60, kernel = "radial", cost = 1, scale = FALSE)
```

###### Donators 600

```{r}
lmf4_2_nl <- lm(Y_contacts ~ ., data=dftr_sim_nl4_60)
bag_train4_2_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl4_60, 
                   method = 'treebag',
                   trControl = cvcontrol,
                   importance = TRUE)
rf_train4_2_nl <- train(Y_contacts ~ .,
                  data = dftr_sim_nl4_60, 
                  method = 'rf',
                  trControl = cvcontrol,
                  importance = TRUE)
gbm_train4_2_nl <- train(Y_contacts ~ .,
                   data = dftr_sim_nl4_60,
                   method = "gbm",
                   verbose = F,
                   trControl = cvcontrol)
svm4_2_nl = svm(Y_contacts ~ ., data = dftr_sim_nl4_60, kernel = "linear", cost = 1, scale = FALSE)
svmr4_2_nl = svm(Y_contacts ~ ., data = dftr_sim_nl4_60, kernel = "radial", cost = 1, scale = FALSE)
```

## Compiling tables

Below, we calculate MAE and RMSE manually for each scenario, save them as a vector, and then - as a table. 

#### MAE Linear option

```{r}
lmf1_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(lmf1_1, newdata = dftr_sim_l)))
bag_train1_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(bag_train1_1, newdata = dftr_sim_l)))
rf_train1_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(rf_train1_1, newdata = dftr_sim_l)))
gbm_train1_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(gbm_train1_1, newdata = dftr_sim_l)))
svm1_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svm1_1, newdata = dftr_sim_l)))
svmr1_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svmr1_1, newdata = dftr_sim_l)))

opt1_1mae <- c(lmf1_1mae, bag_train1_1mae, rf_train1_1mae, gbm_train1_1mae, svm1_1mae, svmr1_1mae)
```

```{r}
lmf2_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(lmf2_1, newdata = dftr_sim_l)))
bag_train2_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(bag_train2_1, newdata = dftr_sim_l)))
rf_train2_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(rf_train2_1, newdata = dftr_sim_l)))
gbm_train2_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(gbm_train2_1, newdata = dftr_sim_l)))
svm2_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svm2_1, newdata = dftr_sim_l)))
svmr2_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svmr2_1, newdata = dftr_sim_l)))

opt2_1mae <- c(lmf2_1mae, bag_train2_1mae, rf_train2_1mae, gbm_train2_1mae, svm2_1mae, svmr2_1mae)
```

```{r}
lmf3_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(lmf3_1, newdata = dftr_sim_l)))
bag_train3_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(bag_train3_1, newdata = dftr_sim_l)))
rf_train3_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(rf_train3_1, newdata = dftr_sim_l)))
gbm_train3_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(gbm_train3_1, newdata = dftr_sim_l)))
svm3_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svm3_1, newdata = dftr_sim_l)))
svmr3_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svmr3_1, newdata = dftr_sim_l)))

opt3_1mae <- c(lmf3_1mae, bag_train3_1mae, rf_train3_1mae, gbm_train3_1mae, svm3_1mae, svmr3_1mae)
```

```{r}
lmf4_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(lmf4_1, newdata = dftr_sim_l)))
bag_train4_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(bag_train4_1, newdata = dftr_sim_l)))
rf_train4_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(rf_train4_1, newdata = dftr_sim_l)))
gbm_train4_1mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(gbm_train4_1, newdata = dftr_sim_l)))
svm4_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svm4_1, newdata = dftr_sim_l)))
svmr4_1mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svmr4_1, newdata = dftr_sim_l)))

opt4_1mae <- c(lmf4_1mae, bag_train4_1mae, rf_train4_1mae, gbm_train4_1mae, svm4_1mae, svmr4_1mae)
```

60% Info

```{r}
lmf1_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(lmf1_2, newdata = dftr_sim_l)))
bag_train1_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(bag_train1_2, newdata = dftr_sim_l)))
rf_train1_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(rf_train1_2, newdata = dftr_sim_l)))
gbm_train1_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(gbm_train1_2, newdata = dftr_sim_l)))
svm1_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svm1_2, newdata = dftr_sim_l)))
svmr1_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svmr1_2, newdata = dftr_sim_l)))

opt1_2mae <- c(lmf1_2mae, bag_train1_2mae, rf_train1_2mae, gbm_train1_2mae, svm1_2mae, svmr1_2mae)
```

```{r}
lmf2_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(lmf2_2, newdata = dftr_sim_l)))
bag_train2_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(bag_train2_2, newdata = dftr_sim_l)))
rf_train2_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(rf_train2_2, newdata = dftr_sim_l)))
gbm_train2_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(gbm_train2_2, newdata = dftr_sim_l)))
svm2_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svm2_2, newdata = dftr_sim_l)))
svmr2_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svmr2_2, newdata = dftr_sim_l)))

opt2_2mae <- c(lmf2_2mae, bag_train2_2mae, rf_train2_2mae, gbm_train2_2mae, svm2_2mae, svmr2_2mae)
```

```{r}
lmf3_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(lmf3_2, newdata = dftr_sim_l)))
bag_train3_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(bag_train3_2, newdata = dftr_sim_l)))
rf_train3_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(rf_train3_2, newdata = dftr_sim_l)))
gbm_train3_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(gbm_train3_2, newdata = dftr_sim_l)))
svm3_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svm3_2, newdata = dftr_sim_l)))
svmr3_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svmr3_2, newdata = dftr_sim_l)))

opt3_2mae <- c(lmf3_2mae, bag_train3_2mae, rf_train3_2mae, gbm_train3_2mae, svm3_2mae, svmr3_2mae)
```

```{r}
lmf4_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(lmf4_2, newdata = dftr_sim_l)))
bag_train4_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(bag_train4_2, newdata = dftr_sim_l)))
rf_train4_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(rf_train4_2, newdata = dftr_sim_l)))
gbm_train4_2mae <- mean(abs(dftr_sim_l$Y_contacts -  predict(gbm_train4_2, newdata = dftr_sim_l)))
svm4_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svm4_2, newdata = dftr_sim_l)))
svmr4_2mae <- mean(abs(dftr_sim_l$Y_contacts - predict(svmr4_2, newdata = dftr_sim_l)))

opt4_2mae <- c(lmf4_2mae, bag_train4_2mae, rf_train4_2mae, gbm_train4_2mae, svm4_2mae, svmr4_2mae)
```

Lets compile a table from saved rows

```{r}
mae_table1 <- data.frame(opt1_1mae, opt2_1mae, opt3_1mae, opt4_1mae)
rownames(mae_table1) <- c("lmf", "bag", "rf", "gbm", "svm", "svmr")
mae_table2 <- data.frame(opt1_2mae, opt2_2mae, opt3_2mae, opt4_2mae)
rownames(mae_table2) <- c("lmf", "bag", "rf", "gbm", "svm", "svmr")
# now, join them
mae_table <- cbind(mae_table1, mae_table2)
t(mae_table)
```

### RMSE Linear Option

```{r}
lmf1_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(lmf1_1, newdata = dftr_sim_l))^2))
bag_train1_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(bag_train1_1, newdata = dftr_sim_l))^2))
rf_train1_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(rf_train1_1, newdata = dftr_sim_l))^2))
gbm_train1_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(gbm_train1_1, newdata = dftr_sim_l))^2))
svm1_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svm1_1, newdata = dftr_sim_l))^2))
svmr1_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svmr1_1, newdata = dftr_sim_l))^2))

opt1_1rmse <- c(lmf1_1rmse, bag_train1_1rmse, rf_train1_1rmse, gbm_train1_1rmse, svm1_1rmse, svmr1_1rmse)
```

```{r}
lmf2_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(lmf2_1, newdata = dftr_sim_l))^2))
bag_train2_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(bag_train2_1, newdata = dftr_sim_l))^2))
rf_train2_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(rf_train2_1, newdata = dftr_sim_l))^2))
gbm_train2_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(gbm_train2_1, newdata = dftr_sim_l))^2))
svm2_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svm2_1, newdata = dftr_sim_l))^2))
svmr2_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svmr2_1, newdata = dftr_sim_l))^2))

opt2_1rmse <- c(lmf2_1rmse, bag_train2_1rmse, rf_train2_1rmse, gbm_train2_1rmse, svm2_1rmse, svmr2_1rmse)
```

```{r}
lmf3_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(lmf3_1, newdata = dftr_sim_l))^2))
bag_train3_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(bag_train3_1, newdata = dftr_sim_l))^2))
rf_train3_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(rf_train3_1, newdata = dftr_sim_l))^2))
gbm_train3_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(gbm_train3_1, newdata = dftr_sim_l))^2))
svm3_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svm3_1, newdata = dftr_sim_l))^2))
svmr3_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svmr3_1, newdata = dftr_sim_l))^2))

opt3_1rmse <- c(lmf3_1rmse, bag_train3_1rmse, rf_train3_1rmse, gbm_train3_1rmse, svm3_1rmse, svmr3_1rmse)
```

```{r}
lmf4_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(lmf4_1, newdata = dftr_sim_l))^2))
bag_train4_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(bag_train4_1, newdata = dftr_sim_l))^2))
rf_train4_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(rf_train4_1, newdata = dftr_sim_l))^2))
gbm_train4_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(gbm_train4_1, newdata = dftr_sim_l))^2))
svm4_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svm4_1, newdata = dftr_sim_l))^2))
svmr4_1rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svmr4_1, newdata = dftr_sim_l))^2))

opt4_1rmse <- c(lmf4_1rmse, bag_train4_1rmse, rf_train4_1rmse, gbm_train4_1rmse, svm4_1rmse, svmr4_1rmse)
```

60 % info

```{r}
lmf1_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(lmf1_2, newdata = dftr_sim_l))^2))
bag_train1_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(bag_train1_2, newdata = dftr_sim_l))^2))  
rf_train1_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(rf_train1_2, newdata = dftr_sim_l))^2))
gbm_train1_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(gbm_train1_2, newdata = dftr_sim_l))^2))
svm1_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svm1_2, newdata = dftr_sim_l))^2))
svmr1_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svmr1_2, newdata = dftr_sim_l))^2))

opt1_2rmse <- c(lmf1_2rmse, bag_train1_2rmse, rf_train1_2rmse, gbm_train1_2rmse, svm1_2rmse, svmr1_2rmse)
```

```{r}
lmf2_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(lmf2_2, newdata = dftr_sim_l))^2))
bag_train2_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(bag_train2_2, newdata = dftr_sim_l))^2))
rf_train2_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(rf_train2_2, newdata = dftr_sim_l))^2))
gbm_train2_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(gbm_train2_2, newdata = dftr_sim_l))^2))
svm2_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svm2_2, newdata = dftr_sim_l))^2))
svmr2_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svmr2_2, newdata = dftr_sim_l))^2))

opt2_2rmse <- c(lmf2_2rmse, bag_train2_2rmse, rf_train2_2rmse, gbm_train2_2rmse, svm2_2rmse, svmr2_2rmse)
```

```{r}
lmf3_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(lmf3_2, newdata = dftr_sim_l))^2))
bag_train3_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(bag_train3_2, newdata = dftr_sim_l))^2))
rf_train3_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(rf_train3_2, newdata = dftr_sim_l))^2))
gbm_train3_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(gbm_train3_2, newdata = dftr_sim_l))^2))
svm3_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svm3_2, newdata = dftr_sim_l))^2))
svmr3_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svmr3_2, newdata = dftr_sim_l))^2))

opt3_2rmse <- c(lmf3_2rmse, bag_train3_2rmse, rf_train3_2rmse, gbm_train3_2rmse, svm3_2rmse, svmr3_2rmse)
```

```{r}
lmf4_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(lmf4_2, newdata = dftr_sim_l))^2))
bag_train4_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(bag_train4_2, newdata = dftr_sim_l))^2))
rf_train4_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(rf_train4_2, newdata = dftr_sim_l))^2))
gbm_train4_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts -  predict(gbm_train4_2, newdata = dftr_sim_l))^2))
svm4_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svm4_2, newdata = dftr_sim_l))^2))
svmr4_2rmse <- sqrt(mean((dftr_sim_l$Y_contacts - predict(svmr4_2, newdata = dftr_sim_l))^2))

opt4_2rmse <- c(lmf4_2rmse, bag_train4_2rmse, rf_train4_2rmse, gbm_train4_2rmse, svm4_2rmse, svmr4_2rmse)
```

Combine the RMSE values into a table

```{r}
rmse_table1 <- data.frame(opt1_1rmse, opt2_1rmse, opt3_1rmse, opt4_1rmse)
rownames(rmse_table1) <- c("lmf", "bag", "rf", "gbm", "svm", "svmr")
rmse_table2 <- data.frame(opt1_2rmse, opt2_2rmse, opt3_2rmse, opt4_2rmse)
rownames(rmse_table2) <- c("lmf", "bag", "rf", "gbm", "svm", "svmr")
# now, join them
rmse_table <- cbind(rmse_table1, rmse_table2)
t(rmse_table)
```

### MAE Non-linear option

```{r}
lmf1_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(lmf1_1_nl, newdata = dftr_sim_nl)))
bag_train1_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(bag_train1_1_nl, newdata = dftr_sim_nl)))
rf_train1_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(rf_train1_1_nl, newdata = dftr_sim_nl)))
gbm_train1_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(gbm_train1_1_nl, newdata = dftr_sim_nl)))
svm1_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svm1_1_nl, newdata = dftr_sim_nl)))
svmr1_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svmr1_1_nl, newdata = dftr_sim_nl)))
                      
opt1_1mae_nl <- c(lmf1_1mae_nl, bag_train1_1mae_nl, rf_train1_1mae_nl, gbm_train1_1mae_nl, svm1_1mae_nl, svmr1_1mae_nl)
```

```{r}
lmf2_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(lmf2_1_nl, newdata = dftr_sim_nl)))
bag_train2_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(bag_train2_1_nl, newdata = dftr_sim_nl)))
rf_train2_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(rf_train2_1_nl, newdata = dftr_sim_nl)))
gbm_train2_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(gbm_train2_1_nl, newdata = dftr_sim_nl)))
svm2_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svm2_1_nl, newdata = dftr_sim_nl)))
svmr2_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svmr2_1_nl, newdata = dftr_sim_nl)))
                      
opt2_1mae_nl <- c(lmf2_1mae_nl, bag_train2_1mae_nl, rf_train2_1mae_nl, gbm_train2_1mae_nl, svm2_1mae_nl, svmr2_1mae_nl)
```

```{r}
lmf3_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(lmf3_1_nl, newdata = dftr_sim_nl)))
bag_train3_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(bag_train3_1_nl, newdata = dftr_sim_nl)))
rf_train3_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(rf_train3_1_nl, newdata = dftr_sim_nl)))
gbm_train3_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(gbm_train3_1_nl, newdata = dftr_sim_nl)))
svm3_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svm3_1_nl, newdata = dftr_sim_nl)))
svmr3_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svmr3_1_nl, newdata = dftr_sim_nl)))
                      
opt3_1mae_nl <- c(lmf3_1mae_nl, bag_train3_1mae_nl, rf_train3_1mae_nl, gbm_train3_1mae_nl, svm3_1mae_nl, svmr3_1mae_nl)
```

```{r}
lmf4_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(lmf4_1_nl, newdata = dftr_sim_nl)))
bag_train4_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(bag_train4_1_nl, newdata = dftr_sim_nl)))
rf_train4_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(rf_train4_1_nl, newdata = dftr_sim_nl)))
gbm_train4_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(gbm_train4_1_nl, newdata = dftr_sim_nl)))
svm4_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svm4_1_nl, newdata = dftr_sim_nl)))
svmr4_1mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svmr4_1_nl, newdata = dftr_sim_nl)))
                      
opt4_1mae_nl <- c(lmf4_1mae_nl, bag_train4_1mae_nl, rf_train4_1mae_nl, gbm_train4_1mae_nl, svm4_1mae_nl, svmr4_1mae_nl)
```

60% fraction

```{r}
lmf1_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(lmf1_2_nl, newdata = dftr_sim_nl)))
bag_train1_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(bag_train1_2_nl, newdata = dftr_sim_nl)))
rf_train1_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(rf_train1_2_nl, newdata = dftr_sim_nl)))
gbm_train1_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(gbm_train1_2_nl, newdata = dftr_sim_nl)))
svm1_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svm1_2_nl, newdata = dftr_sim_nl)))
svmr1_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svmr1_2_nl, newdata = dftr_sim_nl)))

opt1_2mae_nl <- c(lmf1_2mae_nl, bag_train1_2mae_nl, rf_train1_2mae_nl, gbm_train1_2mae_nl, svm1_2mae_nl, svmr1_2mae_nl)
```

```{r}
lmf2_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(lmf2_2_nl, newdata = dftr_sim_nl)))
bag_train2_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(bag_train2_2_nl, newdata = dftr_sim_nl)))
rf_train2_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(rf_train2_2_nl, newdata = dftr_sim_nl)))
gbm_train2_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(gbm_train2_2_nl, newdata = dftr_sim_nl)))
svm2_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svm2_2_nl, newdata = dftr_sim_nl)))
svmr2_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svmr2_2_nl, newdata = dftr_sim_nl)))

opt2_2mae_nl <- c(lmf2_2mae_nl, bag_train2_2mae_nl, rf_train2_2mae_nl, gbm_train2_2mae_nl, svm2_2mae_nl, svmr2_2mae_nl)
```

```{r}
lmf3_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(lmf3_2_nl, newdata = dftr_sim_nl)))
bag_train3_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(bag_train3_2_nl, newdata = dftr_sim_nl)))
rf_train3_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(rf_train3_2_nl, newdata = dftr_sim_nl)))
gbm_train3_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(gbm_train3_2_nl, newdata = dftr_sim_nl)))
svm3_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svm3_2_nl, newdata = dftr_sim_nl)))
svmr3_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svmr3_2_nl, newdata = dftr_sim_nl)))

opt3_2mae_nl <- c(lmf3_2mae_nl, bag_train3_2mae_nl, rf_train3_2mae_nl, gbm_train3_2mae_nl, svm3_2mae_nl, svmr3_2mae_nl)
```

```{r}
lmf4_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(lmf4_2_nl, newdata = dftr_sim_nl)))
bag_train4_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(bag_train4_2_nl, newdata = dftr_sim_nl)))
rf_train4_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(rf_train4_2_nl, newdata = dftr_sim_nl)))
gbm_train4_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts -  predict(gbm_train4_2_nl, newdata = dftr_sim_nl)))
svm4_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svm4_2_nl, newdata = dftr_sim_nl)))
svmr4_2mae_nl <- mean(abs(dftr_sim_nl$Y_contacts - predict(svmr4_2_nl, newdata = dftr_sim_nl)))

opt4_2mae_nl <- c(lmf4_2mae_nl, bag_train4_2mae_nl, rf_train4_2mae_nl, gbm_train4_2mae_nl, svm4_2mae_nl, svmr4_2mae_nl)
```

Combine the MAE values into a table for non-linear cases

```{r}
mae_table1_nl <- data.frame(opt1_1mae_nl, opt2_1mae_nl, opt3_1mae_nl, opt4_1mae_nl)
rownames(mae_table1_nl) <- c("lmf", "bag", "rf", "gbm", "svm", "svmr")
mae_table2_nl <- data.frame(opt1_2mae_nl, opt2_2mae_nl, opt3_2mae_nl, opt4_2mae_nl)
rownames(mae_table2_nl) <- c("lmf", "bag", "rf", "gbm", "svm", "svmr")
# now, join them
mae_table_nl <- cbind(mae_table1_nl, mae_table2_nl)
t(mae_table_nl)
```

### RMSE Non-Linear Option

```{r}
lmf1_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(lmf1_1_nl, newdata = dftr_sim_nl))^2))
bag_train1_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(bag_train1_1_nl, newdata = dftr_sim_nl))^2))
rf_train1_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(rf_train1_1_nl, newdata = dftr_sim_nl))^2))
gbm_train1_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(gbm_train1_1_nl, newdata = dftr_sim_nl))^2))
svm1_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svm1_1_nl, newdata = dftr_sim_nl))^2))
svmr1_1rmse <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svmr1_1_nl, newdata = dftr_sim_nl))^2))

opt1_1rmse_nl <- c(lmf1_1rmse_nl, bag_train1_1rmse_nl, rf_train1_1rmse_nl, gbm_train1_1rmse_nl, svm1_1rmse_nl, svmr1_1rmse)
```

```{r}
lmf2_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(lmf2_1_nl, newdata = dftr_sim_nl))^2))
bag_train2_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(bag_train2_1_nl, newdata = dftr_sim_nl))^2))
rf_train2_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(rf_train2_1_nl, newdata = dftr_sim_nl))^2))
gbm_train2_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(gbm_train2_1_nl, newdata = dftr_sim_nl))^2))
svm2_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svm2_1_nl, newdata = dftr_sim_nl))^2))
svmr2_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svmr2_1_nl, newdata = dftr_sim_nl))^2))

opt2_1rmse_nl <- c(lmf2_1rmse_nl, bag_train2_1rmse_nl, rf_train2_1rmse_nl, gbm_train2_1rmse_nl, svm2_1rmse_nl, svmr2_1rmse_nl)
```

```{r}
lmf3_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(lmf3_1_nl, newdata = dftr_sim_nl))^2))
bag_train3_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(bag_train3_1_nl, newdata = dftr_sim_nl))^2))
rf_train3_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(rf_train3_1_nl, newdata = dftr_sim_nl))^2))
gbm_train3_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(gbm_train3_1_nl, newdata = dftr_sim_nl))^2))
svm3_1rmse <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svm3_1_nl, newdata = dftr_sim_nl))^2))
svmr3_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svmr3_1_nl, newdata = dftr_sim_nl))^2))

opt3_1rmse_nl <- c(lmf3_1rmse_nl, bag_train3_1rmse_nl, rf_train3_1rmse_nl, gbm_train3_1rmse_nl, svm3_1rmse, svmr3_1rmse_nl)
```

```{r}
lmf4_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(lmf4_1_nl, newdata = dftr_sim_nl))^2))
bag_train4_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(bag_train4_1_nl, newdata = dftr_sim_nl))^2))
rf_train4_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(rf_train4_1_nl, newdata = dftr_sim_nl))^2))
gbm_train4_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(gbm_train4_1_nl, newdata = dftr_sim_nl))^2))
svm4_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svm4_1_nl, newdata = dftr_sim_nl))^2))
svmr4_1rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svmr4_1_nl, newdata = dftr_sim_nl))^2))

opt4_1rmse_nl <- c(lmf4_1rmse_nl, bag_train4_1rmse_nl, rf_train4_1rmse_nl, gbm_train4_1rmse_nl, svm4_1rmse, svmr4_1rmse_nl)
```

60%

```{r}
lmf1_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(lmf1_2_nl, newdata = dftr_sim_nl))^2))
bag_train1_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(bag_train1_2_nl, newdata = dftr_sim_nl))^2))
rf_train1_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(rf_train1_2_nl, newdata = dftr_sim_nl))^2))
gbm_train1_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(gbm_train1_2_nl, newdata = dftr_sim_nl))^2))
svm1_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svm1_2_nl, newdata = dftr_sim_nl))^2))
svmr1_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svmr1_2_nl, newdata = dftr_sim_nl))^2))

opt1_2rmse_nl <- c(lmf1_2rmse_nl, bag_train1_2rmse_nl, rf_train1_2rmse_nl, gbm_train1_2rmse_nl, svm1_2rmse_nl, svmr1_2rmse_nl)
```

```{r}
lmf2_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(lmf2_2_nl, newdata = dftr_sim_nl))^2))
bag_train2_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(bag_train2_2_nl, newdata = dftr_sim_nl))^2))
rf_train2_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(rf_train2_2_nl, newdata = dftr_sim_nl))^2))
gbm_train2_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(gbm_train2_2_nl, newdata = dftr_sim_nl))^2))
svm2_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svm2_2_nl, newdata = dftr_sim_nl))^2))
svmr2_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svmr2_2_nl, newdata = dftr_sim_nl))^2))

opt2_2rmse_nl <- c(lmf2_2rmse_nl, bag_train2_2rmse_nl, rf_train2_2rmse_nl, gbm_train2_2rmse_nl, svm2_2rmse_nl, svmr2_2rmse_nl)
```


```{r}
lmf3_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(lmf3_2_nl, newdata = dftr_sim_nl))^2))
bag_train3_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(bag_train3_2_nl, newdata = dftr_sim_nl))^2))
rf_train3_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(rf_train3_2_nl, newdata = dftr_sim_nl))^2))
gbm_train3_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(gbm_train3_2_nl, newdata = dftr_sim_nl))^2))
svm3_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svm3_2_nl, newdata = dftr_sim_nl))^2))
svmr3_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svmr3_2_nl, newdata = dftr_sim_nl))^2))

opt3_2rmse_nl <- c(lmf3_2rmse_nl, bag_train3_2rmse_nl, rf_train3_2rmse_nl, gbm_train3_2rmse_nl, svm3_2rmse_nl, svmr3_2rmse_nl)
```

```{r}
lmf4_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(lmf4_2_nl, newdata = dftr_sim_nl))^2))
bag_train4_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(bag_train4_2_nl, newdata = dftr_sim_nl))^2))
rf_train4_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(rf_train4_2_nl, newdata = dftr_sim_nl))^2))
gbm_train4_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts -  predict(gbm_train4_2_nl, newdata = dftr_sim_nl))^2))
svm4_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svm4_2_nl, newdata = dftr_sim_nl))^2))
svmr4_2rmse_nl <- sqrt(mean((dftr_sim_nl$Y_contacts - predict(svmr4_2_nl, newdata = dftr_sim_nl))^2))

opt4_2rmse_nl <- c(lmf4_2rmse_nl, bag_train4_2rmse_nl, rf_train4_2rmse_nl, gbm_train4_2rmse_nl, svm4_2rmse_nl, svmr4_2rmse_nl)
```

Combine the RMSE values into a table

```{r}
rmse_table1_nl <- data.frame(opt1_1rmse_nl, opt2_1rmse_nl, opt3_1rmse_nl, opt4_1rmse_nl)
rownames(rmse_table1_nl) <- c("lmf", "bag", "rf", "gbm", "svm", "svmr")
rmse_table2_nl <- data.frame(opt1_2rmse_nl, opt2_2rmse_nl, opt3_2rmse_nl, opt4_2rmse_nl)
rownames(rmse_table2_nl) <- c("lmf", "bag", "rf", "gbm", "svm", "svmr")
# now, join them
rmse_table_nl <- cbind(rmse_table1_nl, rmse_table2_nl)
t(rmse_table_nl)
```

## Now, Add Legend and Save Tables

```{r}
Frac <- c("30", "30", "30", "30", "60", "60", "60", "60")
N <- c("100", "200", "300", "400", "100", "200", "300", "400")

mae_table <- cbind(Frac, N, t(mae_table))
colnames(mae_table)  <- c("Frac", "N", "LMF", "BAG", "RF", "GBM", "SVM", "SVMR")
mae_table <- round(apply(mae_table, 2, as.numeric),3)

rmse_table <- cbind(Frac, N, t(rmse_table))
colnames(rmse_table)  <- c("Frac", "N", "LMF", "BAG", "RF", "GBM", "SVM", "SVMR")
rmse_table <- round(apply(rmse_table, 2, as.numeric),3) 

mae_table_nl <- cbind(Frac, N, t(mae_table_nl))
colnames(mae_table_nl)  <- c("Frac", "N", "LMF", "BAG", "RF", "GBM", "SVM", "SVMR")
mae_table_nl <- round(apply(mae_table_nl, 2, as.numeric),3)

rmse_table_nl <- cbind(Frac, N, t(rmse_table_nl))
colnames(rmse_table_nl)  <- c("Frac", "N", "LMF", "BAG", "RF", "GBM", "SVM", "SVMR")
rmse_table_nl <- round(apply(rmse_table_nl, 2, as.numeric),3)
```

Check whether table converted correctly:

```{r}
xtable(mae_table, type = "latex", file = "mae_table.tex")
xtable(rmse_table, type = "latex", file = "mse_table.tex")
xtable(mae_table_nl, type = "latex", file = "rmse_table.tex")
xtable(rmse_table_nl, type = "latex", file = "mape_table.tex")
```

Save them:

```{r}
tab1 <- xtable(mae_table, type = "latex", file = "mae_table.tex")
tab2 <- xtable(rmse_table, type = "latex", file = "rmse_table.tex")
tab3 <- xtable(mae_table_nl, type = "latex", file = "mae_table_nl.tex")
tab4 <- xtable(rmse_table_nl, type = "latex", file = "rmse_table_nl.tex")
# the code is used for the paper. We save the results separately.
write.csv(tab1, ".../DTD-donation/Study 2/Output/mae_table.csv")
write.csv(tab2, ".../DTD-donation/Study 2/Output/rmse_table.csv")
write.csv(tab3, ".../DTD-donation/Study 2/Output/mae_table_nl.csv")
write.csv(tab4, ".../DTD-donation/Study 2/Output/rmse_table_nl.csv")
```

## Empirical Data Evaluation

Manually extract predictions for empirical data

```{r}
lmf_mae <- mean(abs(dfcontact$contacten - predict(lmf)))
lmf_mae
bag_train_mae <- mean(abs(dfcontact$contacten - predict(bag_train)))
bag_train_mae
rf_train_mae <- mean(abs(dfcontact$contacten - predict(rf_train)))
rf_train_mae
gbm_train_mae <- mean(abs(dfcontact$contacten - predict(gbm_train)))
gbm_train_mae
svm_mae <- mean(abs(dfcontact$contacten - predict(svm)))
svm_mae
svmr_mae <- mean(abs(dfcontact$contacten - predict(svmr)))
svmr_mae
```

```{r}
lmf_rmse <- sqrt(mean((dfcontact$contacten - predict(lmf))^2))
lmf_rmse
bag_train_rmse <- sqrt(mean((dfcontact$contacten - predict(bag_train))^2))
bag_train_rmse
rf_train_rmse <- sqrt(mean((dfcontact$contacten - predict(rf_train))^2))
rf_train_rmse
gbm_train_rmse <- sqrt(mean((dfcontact$contacten - predict(gbm_train))^2))
gbm_train_rmse
svm_rmse <- sqrt(mean((dfcontact$contacten - predict(svm))^2))
svm_rmse
svmr_rmse <- sqrt(mean((dfcontact$contacten - predict(svmr))^2))
svmr_rmse
```

Now, show descriptives for the Appendix.

```{r}
stargazer(df)
stargazer(dfcontact)
```

Now, check metadata for public repository.

```{r}
loaded_packages <- sessionInfo()$otherPkgs
package_info <- sapply(loaded_packages, function(x) paste(x$Package, x$Version, sep = " "))
names(package_info) <- NULL
package_info
```

